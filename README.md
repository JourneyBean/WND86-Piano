# WND86-Piano

唐都仪器WND86平台电子琴课程设计项目

## 硬件连接说明

本设计使用8254定时器的通道0产生1kHz方波，输入到80386片载中断芯片的MIR7端口作为Systick中断源；使用8254定时器的通道1产生不同频率方波信号，用于蜂鸣器发声；使用8255并口芯片的B口输出数码管段选信号，A口根据实验箱数码管和矩阵键盘模块的复用电路，输出数码管片选或者键盘扫描信号，C口低4位输入键盘扫描信号，C4口连接8254定时器通道GATE1，作为蜂鸣器使能信号。

## 软件实现介绍

硬件使用一个Systick中断，在中断程序内将增加内存Systick计数值作为设备内部时间戳。同时中断程序负责数码管动态扫描显示，根据上次中断记录的状态显示数码管的下一字符。主程序初始化完成后即进入主循环，循环一开始即进行按键扫描，扫描后根据按键按下、弹起、保持、空闲四个事件，分别执行对应处理程序。这些程序包括：按键按下事件的钢琴处理钩子、按键按下事件的录音处理钩子、按键按下事件的模式切换处理钩子、按键按下事件的播放处理钩子、按键弹起事件的钢琴处理钩子、按键弹起事件的录音处理钩子、按键空闲事件的播放处理钩子。“钩子”的概念即事件触发后的链式处理程序，如同钩子一般一个接着一个。
